<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DR Private Limited - Internship Opportunities</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f2f5;
            color: #333;
        }
        .container {
            max-width: 960px;
        }
        .section-title {
            border-bottom: 2px solid #e2e8f0;
            padding-bottom: 0.5rem;
            margin-bottom: 1.5rem;
        }
        .loading-spinner {
            border-top-color: #3b82f6;
            border-bottom-color: #3b82f6;
        }
        input[type="text"],
        input[type="email"],
        input[type="number"],
        select {
            @apply w-full p-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500;
        }
        button {
            @apply px-6 py-3 bg-blue-600 text-white font-bold rounded-md hover:bg-blue-700 transition duration-300 ease-in-out shadow-md;
        }
        .message-box {
            @apply p-4 rounded-md text-sm font-medium mt-4;
        }
        .message-box.success {
            @apply bg-green-100 text-green-800 border border-green-300;
        }
        .message-box.error {
            @apply bg-red-100 text-red-800 border border-red-300;
        }
        .image-placeholder {
            background-color: #e0e0e0;
            display: flex;
            align-items: center;
            justify-content: center;
            height: 200px; /* Adjust as needed */
            color: #757575;
            font-style: italic;
            border-radius: 0.5rem;
            text-align: center;
        }
    </style>
</head>
<body class="flex flex-col items-center py-8 px-4">
    <div class="container bg-white rounded-xl shadow-lg p-8 md:p-12">
        <!-- Header Section -->
        <header class="text-center mb-10">
            <h1 class="text-4xl md:text-5xl font-extrabold text-blue-700 mb-4 tracking-tight">
                Unlock Your Potential with <span class="text-purple-600">DR Private Limited!</span>
            </h1>
            <p class="text-lg md:text-xl text-gray-700">
                In collaboration with <span class="font-semibold">Dilshan Rashid Internship Counsellor</span>
            </p>
            <p id="user-id-display" class="text-sm text-gray-500 mt-2"></p>
        </header>

        <!-- Main Content Section -->
        <section class="mb-12">
            <h2 class="text-3xl font-bold text-gray-800 mb-6 section-title">Why Intern with Us?</h2>
            <ul class="list-disc list-inside text-lg text-gray-700 space-y-3">
                <li><span class="font-semibold">Practical Experience:</span> Work on real projects that make a difference.</li>
                <li><span class="font-semibold">Flexible Durations:</span> Choose the internship period that fits your schedule.</li>
                <li><span class="font-semibold">Affordable Investment:</span> High-quality experience at an unbeatable price.</li>
                <li><span class="font-semibold">Certification:</span> Receive a professional certificate upon successful completion.</li>
                <li><span class="font-semibold">Resume Boost:</span> Enhance your profile with practical industry exposure.</li>
            </ul>
        </section>

        <!-- Internship Durations & Pricing Section -->
        <section class="mb-12">
            <h2 class="text-3xl font-bold text-gray-800 mb-6 section-title">Internship Durations & Pricing</h2>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 text-center">
                <div class="bg-blue-50 p-6 rounded-lg shadow-md border-2 border-blue-200">
                    <h3 class="text-2xl font-bold text-blue-800 mb-2">15 Days</h3>
                    <p class="text-4xl font-extrabold text-blue-600">₹99</p>
                </div>
                <div class="bg-purple-50 p-6 rounded-lg shadow-md border-2 border-purple-200">
                    <h3 class="text-2xl font-bold text-purple-800 mb-2">30 Days</h3>
                    <p class="text-4xl font-extrabold text-purple-600">₹159</p>
                </div>
                <div class="bg-green-50 p-6 rounded-lg shadow-md border-2 border-green-200">
                    <h3 class="text-2xl font-bold text-green-800 mb-2">2 Months</h3>
                    <p class="text-4xl font-extrabold text-green-600">₹259</p>
                </div>
            </div>
            <p class="text-center text-sm text-gray-600 mt-6 italic">
                (Each price is for one internship. You have the flexibility to undertake two or even three internships simultaneously to strengthen your resume further. We highly recommend doing at least two for maximum impact!)
            </p>
        </section>

        <!-- Application Form Section -->
        <section class="mb-12">
            <h2 class="text-3xl font-bold text-gray-800 mb-6 section-title">Apply for Internship</h2>
            <form id="internshipApplicationForm" class="space-y-6">
                <div>
                    <label for="fullName" class="block text-lg font-medium text-gray-700 mb-2">Your Full Name</label>
                    <input type="text" id="fullName" name="fullName" placeholder="John Doe" required>
                </div>
                <div>
                    <label for="personalMail" class="block text-lg font-medium text-gray-700 mb-2">Personal Email</label>
                    <input type="email" id="personalMail" name="personalMail" placeholder="john.doe@example.com" required>
                </div>
                <div>
                    <label for="universityName" class="block text-lg font-medium text-gray-700 mb-2">University Name</label>
                    <input type="text" id="universityName" name="universityName" placeholder="ABC University" required>
                </div>
                <div>
                    <label for="domain" class="block text-lg font-medium text-gray-700 mb-2">Domain of Interest</label>
                    <input type="text" id="domain" name="domain" placeholder="e.g., Marketing, Software Development" required>
                </div>
                <div>
                    <label for="course" class="block text-lg font-medium text-gray-700 mb-2">Course</label>
                    <input type="text" id="course" name="course" placeholder="e.g., B.Tech, MBA" required>
                </div>
                <div>
                    <label for="specialization" class="block text-lg font-medium text-gray-700 mb-2">Specialization</label>
                    <input type="text" id="specialization" name="specialization" placeholder="e.g., Computer Science, Finance" required>
                </div>
                <div>
                    <label for="year" class="block text-lg font-medium text-gray-700 mb-2">Year of Study</label>
                    <input type="number" id="year" name="year" placeholder="e.g., 2025" min="1900" max="2100" required>
                </div>
                <div>
                    <label for="duration" class="block text-lg font-medium text-gray-700 mb-2">Internship Duration</label>
                    <select id="duration" name="duration" required>
                        <option value="">Select Duration</option>
                        <option value="15 Days">15 Days</option>
                        <option value="30 Days">30 Days</option>
                        <option value="2 Months">2 Months</option>
                    </select>
                </div>
                <button type="submit" id="submitButton">Submit Application</button>
                <div id="formMessage" class="message-box hidden"></div>
            </form>
        </section>

        <!-- Submitted Applications Section -->
        <section class="mb-12">
            <h2 class="text-3xl font-bold text-gray-800 mb-6 section-title">Submitted Applications</h2>
            <div id="applicationsList" class="space-y-6">
                <!-- Submitted applications will be loaded here -->
                <div id="loadingApplications" class="flex justify-center items-center h-24">
                    <div class="animate-spin rounded-full h-12 w-12 border-t-4 border-b-4 border-purple-500 loading-spinner"></div>
                </div>
                <p id="noApplicationsMessage" class="text-gray-600 text-center hidden">No applications submitted yet.</p>
                <p id="errorApplicationsText" class="text-red-500 mt-4 hidden text-center"></p>
            </div>
        </section>

        <!-- Payment Section -->
        <section class="mb-12 text-center">
            <h2 class="text-3xl font-bold text-gray-800 mb-6 section-title">Secure Your Spot Today!</h2>
            <p class="text-2xl font-bold text-gray-800 mb-4">Make your payment easily via UPI:</p>
            <div class="bg-yellow-100 border-4 border-yellow-400 rounded-xl p-6 inline-block shadow-lg">
                <p class="text-4xl md:text-5xl font-extrabold text-yellow-800">UPI ID: 9693120777</p>
            </div>
            <p class="text-lg text-gray-700 mt-6">
                Don't miss this chance to build a strong foundation for your future career. We look forward to welcoming you to the DR Private Limited family!
            </p>
        </section>

        <!-- Your Custom Image Section -->
        <section class="mb-12">
            <h2 class="text-3xl font-bold text-gray-800 mb-6 section-title">Our Visuals</h2>
            <div class="bg-gray-50 rounded-lg shadow-md p-6 space-y-6">
                <div>
                    <h3 class="text-xl font-semibold text-gray-700 mb-2">Our Team in Action</h3>
                    <!-- Paste your team image link here in the src attribute -->
                    <img src="https://img.freepik.com/premium-photo/group-asian-students-studying-together-classroom-using-laptop_368093-8846.jpg" alt="Our Team Working" class="w-full h-auto rounded-lg shadow-md mt-4">
                    
                </div>
                <div>
                    <h3 class="text-xl font-semibold text-gray-700 mb-2">Certificate Lookalike</h3>
                    <!-- Paste your certificate image link here in the src attribute -->
                    <img src="https://craftmypdf.s3.ap-southeast-1.amazonaws.com/apps/certs-v2/cert-v2-template-05.png" alt="Certificate Template" class="w-full h-auto rounded-lg shadow-md mt-4">
                    </div>
            </div>
        </section>

        <!-- Footer Section -->
        <footer class="text-center text-gray-600 mt-10 pt-6 border-t border-gray-200">
            <p>&copy; 2025 DR Private Limited. All rights reserved.</p>
            <p class="mt-2">Dilshan Rashid Internship Counsellor</p>
        </footer>
    </div>

    <script type="module">
        // Firebase imports
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, collection, addDoc, onSnapshot, query, serverTimestamp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        let app;
        let db;
        let auth;
        let userId = 'anonymous'; // Default to anonymous

        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : {};
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;

        const form = document.getElementById('internshipApplicationForm');
        const submitButton = document.getElementById('submitButton');
        const formMessage = document.getElementById('formMessage');
        const applicationsList = document.getElementById('applicationsList');
        const loadingApplications = document.getElementById('loadingApplications');
        const noApplicationsMessage = document.getElementById('noApplicationsMessage');
        const errorApplicationsText = document.getElementById('errorApplicationsText');
        const userIdDisplay = document.getElementById('user-id-display');

        // Function to show messages
        function showMessage(element, message, type) {
            element.textContent = message;
            element.className = `message-box ${type}`;
            element.classList.remove('hidden');
        }

        // Initialize Firebase and set up authentication listener
        async function initializeFirebase() {
            try {
                if (!app) { // Initialize only once
                    app = initializeApp(firebaseConfig);
                    db = getFirestore(app);
                    auth = getAuth(app);

                    onAuthStateChanged(auth, async (user) => {
                        if (user) {
                            userId = user.uid;
                            userIdDisplay.textContent = `Your User ID: ${userId}`;
                            console.log("Firebase authenticated. User ID:", userId);
                            // Start listening for applications only after auth is ready
                            listenForApplications();
                        } else {
                            console.log("No user signed in. Attempting anonymous sign-in or custom token sign-in.");
                            try {
                                if (initialAuthToken) {
                                    await signInWithCustomToken(auth, initialAuthToken);
                                    console.log("Signed in with custom token.");
                                } else {
                                    await signInAnonymously(auth);
                                    console.log("Signed in anonymously.");
                                }
                            } catch (error) {
                                console.error("Firebase authentication error:", error);
                                userIdDisplay.textContent = "Authentication failed. Some features may not work.";
                                showMessage(errorApplicationsText, `Authentication failed: ${error.message}`, 'error');
                            }
                        }
                    });
                }
            } catch (error) {
                console.error("Firebase initialization error:", error);
                showMessage(errorApplicationsText, `Firebase initialization failed: ${error.message}`, 'error');
            }
        }

        // Function to submit application data to Firestore
        async function submitApplication(event) {
            event.preventDefault(); // Prevent default form submission

            submitButton.disabled = true;
            showMessage(formMessage, 'Submitting your application...', 'info');

            const formData = {
                fullName: document.getElementById('fullName').value,
                personalMail: document.getElementById('personalMail').value,
                universityName: document.getElementById('universityName').value,
                domain: document.getElementById('domain').value,
                course: document.getElementById('course').value,
                specialization: document.getElementById('specialization').value,
                year: parseInt(document.getElementById('year').value),
                duration: document.getElementById('duration').value,
                submittedBy: userId, // Store the user ID who submitted
                timestamp: serverTimestamp() // Firestore server timestamp
            };

            try {
                // Ensure auth is ready before attempting Firestore operation
                if (!auth.currentUser) {
                    throw new Error("User not authenticated. Please wait for authentication to complete.");
                }

                const applicationsCollectionRef = collection(db, `artifacts/${appId}/public/data/internship_applications`);
                await addDoc(applicationsCollectionRef, formData);

                showMessage(formMessage, 'Application submitted successfully! You will receive an offer letter within 7 days.', 'success');
                form.reset(); // Clear the form
            } catch (error) {
                console.error("Error submitting application:", error);
                showMessage(formMessage, `Error submitting application: ${error.message}`, 'error');
            } finally {
                submitButton.disabled = false;
            }
        }

        // Function to listen for real-time updates from Firestore
        function listenForApplications() {
            if (!db) {
                console.error("Firestore not initialized.");
                showMessage(errorApplicationsText, "Firestore not available to load applications.", 'error');
                return;
            }

            loadingApplications.classList.remove('hidden');
            noApplicationsMessage.classList.add('hidden');
            errorApplicationsText.classList.add('hidden');
            applicationsList.innerHTML = ''; // Clear previous list

            const applicationsCollectionRef = collection(db, `artifacts/${appId}/public/data/internship_applications`);
            const q = query(applicationsCollectionRef);

            onSnapshot(q, (snapshot) => {
                loadingApplications.classList.add('hidden');
                if (snapshot.empty) {
                    noApplicationsMessage.classList.remove('hidden');
                    return;
                }

                applicationsList.innerHTML = ''; // Clear existing list before rendering
                snapshot.forEach((doc) => {
                    const data = doc.data();
                    const applicationCard = document.createElement('div');
                    applicationCard.className = 'bg-blue-50 p-4 rounded-lg shadow-sm border border-blue-200';
                    applicationCard.innerHTML = `
                        <h4 class="text-xl font-semibold text-blue-800">${data.fullName}</h4>
                        <p class="text-gray-700"><strong>Email:</strong> ${data.personalMail}</p>
                        <p class="text-gray-700"><strong>University:</strong> ${data.universityName}</p>
                        <p class="text-gray-700"><strong>Domain:</strong> ${data.domain}</p>
                        <p class="text-gray-700"><strong>Course:</strong> ${data.course} (${data.specialization})</p>
                        <p class="text-gray-700"><strong>Year:</strong> ${data.year}</p>
                        <p class="text-gray-700"><strong>Duration:</strong> ${data.duration}</p>
                        <p class="text-gray-500 text-sm mt-2">Submitted by: ${data.submittedBy} on ${data.timestamp ? new Date(data.timestamp.toDate()).toLocaleString() : 'N/A'}</p>
                    `;
                    applicationsList.appendChild(applicationCard);
                });
            }, (error) => {
                console.error("Error fetching applications:", error);
                loadingApplications.classList.add('hidden');
                showMessage(errorApplicationsText, `Error loading applications: ${error.message}`, 'error');
            });
        }

        // Event listeners and initial calls
        window.onload = function() {
            initializeFirebase(); // Initialize Firebase first

            form.addEventListener('submit', submitApplication);
        };
    </script>
</body>
</html>
